{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content %}
<h2>Create Account</h2>
<form method="post" class="mt-3" novalidate>
  {% csrf_token %}
  <div class="mb-3">
    <label class="form-label">Username</label>
    <input type="text" name="username" class="form-control" value="{{ form.username.value|default:'' }}">
    {% if form.username.errors %}<div class="text-danger">{{ form.username.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">Email</label>
    <input type="email" name="email" class="form-control" value="{{ form.email.value|default:'' }}">
    {% if form.email.errors %}<div class="text-danger">{{ form.email.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">First name</label>
    <input type="text" name="first_name" class="form-control" value="{{ form.first_name.value|default:'' }}">
    {% if form.first_name.errors %}<div class="text-danger">{{ form.first_name.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">Last name</label>
    <input type="text" name="last_name" class="form-control" value="{{ form.last_name.value|default:'' }}">
    {% if form.last_name.errors %}<div class="text-danger">{{ form.last_name.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">Role</label>
    {{ form.role }}
    {% if form.role.errors %}<div class="text-danger">{{ form.role.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">Password</label>
    <input type="password" name="password1" class="form-control">
    {% if form.password1.errors %}<div class="text-danger">{{ form.password1.errors.0 }}</div>{% endif %}
  </div>
  <div class="mb-3">
    <label class="form-label">Confirm Password</label>
    <input type="password" name="password2" class="form-control">
    {% if form.password2.errors %}<div class="text-danger">{{ form.password2.errors.0 }}</div>{% endif %}
  </div>
  <div id="reader-fields">
    <div class="mb-3">
      <label class="form-label">Subscribe to Publishers</label>
      {{ form.subscriptions_to_publishers }}
      {% if form.subscriptions_to_publishers.errors %}<div class="text-danger">{{ form.subscriptions_to_publishers.errors.0 }}</div>{% endif %}
    </div>
    <div class="mb-3">
      <label class="form-label">Subscribe to Journalists</label>
      {{ form.subscriptions_to_journalists }}
      {% if form.subscriptions_to_journalists.errors %}<div class="text-danger">{{ form.subscriptions_to_journalists.errors.0 }}</div>{% endif %}
    </div>
  </div>
  <button type="submit" class="btn btn-primary">Register</button>
  <a href="/admin/" class="btn btn-link">Login</a>
</form>
<script>
  (function() {
    const roleSelect = document.querySelector('select[name="role"]');
    const readerFields = document.getElementById('reader-fields');
    function toggleReaderFields() {
      if (roleSelect && roleSelect.value === 'READER') {
        readerFields.style.display = 'block';
      } else {
        readerFields.style.display = 'none';
      }
    }
    toggleReaderFields();
    if (roleSelect) roleSelect.addEventListener('change', toggleReaderFields);
  })();
</script>
{% endblock %}
