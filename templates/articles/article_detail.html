{% extends 'base.html' %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
            {% if article.publisher %}
                <li class="breadcrumb-item"><a href="{% url 'publisher_feed' %}">Publishers</a></li>
            {% else %}
                <li class="breadcrumb-item"><a href="{% url 'independent_feed' %}">Independent</a></li>
            {% endif %}
            <li class="breadcrumb-item active" aria-current="page">{{ article.title }}</li>
        </ol>
    </nav>

    <article class="blog-post">
        <h2 class="blog-post-title mb-1">{{ article.title }}</h2>
        <p class="blog-post-meta">
            {{ article.created_at|date:"F d, Y" }} by <a href="#">{{ article.author.username }}</a>
            {% if user.is_authenticated and user.role == 'READER' %}
                <a href="{% url 'subscribe_to_author' article.author.id %}" class="badge bg-info text-decoration-none text-dark">
                    {% if article.author in user.subscriptions_to_journalists.all %}
                        Unsubscribe
                    {% else %}
                        Subscribe
                    {% endif %}
                </a>
            {% endif %}
            {% if article.publisher %}
                | <span class="badge bg-secondary">{{ article.publisher.title }}</span>
            {% else %}
                | <span class="badge bg-success">Independent</span>
            {% endif %}
        </p>

        {% if article.image %}
            <img src="{{ article.image.url }}" class="img-fluid mb-4 rounded" alt="{{ article.title }}">
        {% endif %}

    <div class="article-content">
        {{ article.content|linebreaks }}
    </div>
    
    {% if user.is_authenticated and user == article.author and article.declined_reason %}
        <div class="alert alert-danger mt-4">
            <strong>Declined by editor:</strong>
            <div class="small text-muted">
                {% if article.declined_by %}{{ article.declined_by.username }}{% endif %}
                {% if article.declined_at %}on {{ article.declined_at|date:"M d, Y H:i" }}{% endif %}
            </div>
            <p class="mb-0">{{ article.declined_reason }}</p>
        </div>
    {% endif %}
    </article>
    
    <hr>
    <div class="d-flex gap-2">
        <a href="javascript:history.back()" class="btn btn-outline-secondary">Back</a>
        {% if user.is_authenticated %}
            {% if user.role == 'EDITOR' or user.role == 'JOURNALIST' and article.author == user %}
                <a href="{% url 'edit_article' article.id %}" class="btn btn-primary">Edit Article</a>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}
